<title>Predict!</title>
<script src="jquery.min.js"></script>
<script>
	$(function() {
		var lastStates = [];
		var lastPrediction = {x: 0, y: 0};
		var predictedPosition = {x: 0, y: 0};
		
		function showPrediction(e) {
			e.preventDefault();

			var newX = e.pageX || e.originalEvent.touches[0].pageX;
			var newY = e.pageY || e.originalEvent.touches[0].pageY;
			
			lastStates.unshift({x: newX, y: newY, timestamp: +new Date()});

			var dt = lastStates[0].timestamp - lastStates[1].timestamp;
			var velocity = {
				x: (lastStates[0].x - lastStates[1].x) / dt,
				y: (lastStates[0].y - lastStates[1].y) / dt
			};
			var dt2 = lastStates[1].timestamp - lastStates[2].timestamp;
			var acceleration = {
				x: velocity.x - (lastStates[1].x - lastStates[2].x) / dt2,
				y: velocity.y - (lastStates[1].y - lastStates[2].y) / dt2
			};
			
			$('#mouse-position').html(
				'<p>' + lastStates[0].x + ', ' + lastStates[0].y + '</p>' +
				'<p>time: ' + dt + ', ' + dt2 + '</p>' +
				'<p>velocity: ' + velocity.x + ', ' + velocity.y + '</p>' +
				'<p>acceleration: ' + acceleration.x + ', ' + acceleration.y + '</p>'
			);
			
			//how many ms into the future we are predicting
			var lag = 100;
			lastPrediction = predictedPosition;
			predictedPosition = {
				x: lastStates[0].x + velocity.x * lag + acceleration.x * lag,
				y: lastStates[0].y + velocity.y * lag + acceleration.y * lag
			};
			var adjustment = 0.5;
			predictedPosition.x = lastPrediction.x * adjustment + predictedPosition.x * (1 - adjustment);
			predictedPosition.y = lastPrediction.y * adjustment + predictedPosition.y * (1 - adjustment);
			
			var left = (newX - 123) + 'px';
			var top = (newY - 123) + 'px';
			//use prediction only on right half of document
			if (newX * 2 > window.innerWidth) {
				left = (predictedPosition.x - 123) + 'px';
				top = (predictedPosition.y - 123) + 'px';
			}
			$('.crosshair').css('left', left).css('top', top);
		}
		$(document).mousemove(showPrediction).bind('touchmove', showPrediction);
	});
</script>
<div id="mouse-position"></div>
<div class="crosshair" style="position: absolute;"><img src="crosshair.png"></div>
