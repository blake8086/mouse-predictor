<title>Predict!</title>
<script src="jquery.min.js"></script>
<script>
	$(function() {
		var lastStates = [];
		var predictedPosition = {x: 0, y: 0};
		var indicatorSize = 5;
		var velocity = {x: 0, y: 0};
		var acceleration = {x: 0, y: 0};
		
		$('#canvas').attr('height', window.innerHeight).attr('width', window.innerWidth);
		var context = document.getElementById('canvas').getContext('2d');
		
		function showPrediction(e) {
			e.preventDefault();

			var newX = e.pageX || e.originalEvent.touches[0].pageX;
			var newY = e.pageY || e.originalEvent.touches[0].pageY;
			
			lastStates.unshift({x: newX, y: newY, timestamp: +new Date()});

			var dt = lastStates[0].timestamp - lastStates[4].timestamp;
			velocity.x = (lastStates[0].x - lastStates[4].x) / dt;
			velocity.y = (lastStates[0].y - lastStates[4].y) / dt;

			$('#mouse-position').html(
				'<p>' + lastStates[0].x + ', ' + lastStates[0].y + '</p>' +
				'<p>time: ' + dt + '</p>' +
				'<p>velocity: ' + velocity.x + ', ' + velocity.y + '</p>'
			);
			
			//how many ms into the future we are predicting
			var lag = 5 * (1000 / 60);
			predictedPosition = {
				x: lastStates[0].x + velocity.x * lag,
				y: lastStates[0].y + velocity.y * lag
			};

			var left = newX - (indicatorSize - 1) / 2;
			var top = newY - (indicatorSize - 1) / 2;

			context.beginPath();
			context.strokeStyle = '#aaa';
			context.moveTo(newX, newY);
			context.lineTo(predictedPosition.x, predictedPosition.y);
			context.stroke();
			
			context.fillStyle = 'green';
			context.fillRect(left, top, indicatorSize, indicatorSize);

			left = predictedPosition.x - (indicatorSize - 1) / 2;
			top = predictedPosition.y - (indicatorSize - 1) / 2;

			context.fillStyle = 'blue';
			context.fillRect(left, top, indicatorSize, indicatorSize);
		}
		$(document).mousemove(showPrediction).bind('touchmove', showPrediction);
	});
</script>
<div id="mouse-position"></div>
<canvas id="canvas" height="100" width="100" style="left:0; position: absolute; top: 0;"></canvas>
